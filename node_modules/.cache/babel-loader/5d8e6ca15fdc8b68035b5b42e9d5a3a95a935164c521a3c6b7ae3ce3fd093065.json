{"ast":null,"code":"var _jsxFileName = \"/Users/devenspear/CascadeProjects/HealthApps25/src/lib/auth.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport { ClerkProvider, useAuth, useUser } from '@clerk/clerk-react';\nimport { createUser, initializeDatabase } from './database';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst publishableKey = process.env.REACT_APP_CLERK_PUBLISHABLE_KEY;\nif (!publishableKey) {\n  throw new Error('Missing REACT_APP_CLERK_PUBLISHABLE_KEY environment variable');\n}\n\n// Custom auth context for our app\n\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function AuthProvider({\n  children\n}) {\n  return /*#__PURE__*/_jsxDEV(ClerkProvider, {\n    publishableKey: publishableKey,\n    children: /*#__PURE__*/_jsxDEV(AuthWrapper, {\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 24,\n    columnNumber: 5\n  }, this);\n}\n_c = AuthProvider;\nfunction AuthWrapper({\n  children\n}) {\n  _s();\n  const {\n    isLoaded,\n    isSignedIn,\n    userId,\n    signOut\n  } = useAuth();\n  const {\n    user\n  } = useUser();\n  const [dbInitialized, setDbInitialized] = useState(false);\n\n  // Initialize database and create user when signed in\n  useEffect(() => {\n    async function setupUser() {\n      if (isLoaded && isSignedIn && userId && user && !dbInitialized) {\n        try {\n          var _user$primaryEmailAdd;\n          // Initialize database tables\n          await initializeDatabase();\n\n          // Create or update user in our database\n          await createUser(userId, (_user$primaryEmailAdd = user.primaryEmailAddress) === null || _user$primaryEmailAdd === void 0 ? void 0 : _user$primaryEmailAdd.emailAddress, user.firstName, user.lastName);\n          setDbInitialized(true);\n          console.log('User setup completed');\n        } catch (error) {\n          console.error('Error setting up user:', error);\n        }\n      }\n    }\n    setupUser();\n  }, [isLoaded, isSignedIn, userId, user, dbInitialized]);\n  const authValue = {\n    isLoaded,\n    isSignedIn: isSignedIn || false,\n    userId,\n    user,\n    signOut\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: authValue,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthWrapper, \"t/FxT7li1Fv38ciI3XDg9y6AVog=\", false, function () {\n  return [useAuth, useUser];\n});\n_c2 = AuthWrapper;\nexport function useAppAuth() {\n  _s2();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAppAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n_s2(useAppAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c, _c2;\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"AuthWrapper\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","ClerkProvider","useAuth","useUser","createUser","initializeDatabase","jsxDEV","_jsxDEV","publishableKey","process","env","REACT_APP_CLERK_PUBLISHABLE_KEY","Error","AuthContext","AuthProvider","children","AuthWrapper","fileName","_jsxFileName","lineNumber","columnNumber","_c","_s","isLoaded","isSignedIn","userId","signOut","user","dbInitialized","setDbInitialized","setupUser","_user$primaryEmailAdd","primaryEmailAddress","emailAddress","firstName","lastName","console","log","error","authValue","Provider","value","_c2","useAppAuth","_s2","context","$RefreshReg$"],"sources":["/Users/devenspear/CascadeProjects/HealthApps25/src/lib/auth.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { ClerkProvider, useAuth, useUser } from '@clerk/clerk-react';\nimport { createUser, initializeDatabase } from './database';\n\nconst publishableKey = process.env.REACT_APP_CLERK_PUBLISHABLE_KEY;\n\nif (!publishableKey) {\n  throw new Error('Missing REACT_APP_CLERK_PUBLISHABLE_KEY environment variable');\n}\n\n// Custom auth context for our app\ninterface AuthContextType {\n  isLoaded: boolean;\n  isSignedIn: boolean;\n  userId: string | null;\n  user: any;\n  signOut: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  return (\n    <ClerkProvider publishableKey={publishableKey}>\n      <AuthWrapper>{children}</AuthWrapper>\n    </ClerkProvider>\n  );\n}\n\nfunction AuthWrapper({ children }: { children: React.ReactNode }) {\n  const { isLoaded, isSignedIn, userId, signOut } = useAuth();\n  const { user } = useUser();\n  const [dbInitialized, setDbInitialized] = useState(false);\n\n  // Initialize database and create user when signed in\n  useEffect(() => {\n    async function setupUser() {\n      if (isLoaded && isSignedIn && userId && user && !dbInitialized) {\n        try {\n          // Initialize database tables\n          await initializeDatabase();\n          \n          // Create or update user in our database\n          await createUser(\n            userId,\n            user.primaryEmailAddress?.emailAddress,\n            user.firstName,\n            user.lastName\n          );\n          \n          setDbInitialized(true);\n          console.log('User setup completed');\n        } catch (error) {\n          console.error('Error setting up user:', error);\n        }\n      }\n    }\n\n    setupUser();\n  }, [isLoaded, isSignedIn, userId, user, dbInitialized]);\n\n  const authValue: AuthContextType = {\n    isLoaded,\n    isSignedIn: isSignedIn || false,\n    userId,\n    user,\n    signOut\n  };\n\n  return (\n    <AuthContext.Provider value={authValue}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAppAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAppAuth must be used within an AuthProvider');\n  }\n  return context;\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}